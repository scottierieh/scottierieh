<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üìä Analytics Platform - Descriptive Statistics</title>

<!-- CSV Parsing -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<!-- Plotly -->
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

<style>
  :root{
    --bg:#f8fafc; --card:#ffffff; --muted:#64748b; --accent:#3b82f6; --success:#10b981;
    --warning:#f59e0b; --danger:#ef4444; --purple:#8b5cf6; --info:#06b6d4;
    --shadow:0 4px 6px -1px rgba(0,0,0,0.1); --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1);
    --gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  }
  
  * {box-sizing:border-box;margin:0;padding:0;}
  
  body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:#1e293b;line-height:1.6;margin:0;padding:0}
  
  /* Header Navigation */
  .header{background:white;border-bottom:1px solid #e2e8f0;position:sticky;top:0;z-index:100;box-shadow:var(--shadow)}
  .header-content{max-width:1400px;margin:0 auto;padding:0 24px;display:flex;align-items:center;justify-content:space-between;height:64px}
  .logo{display:flex;align-items:center;gap:12px;font-weight:700;font-size:20px}
  .logo-icon{width:40px;height:40px;background:var(--gradient);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:24px}
  
  .nav-tabs{display:flex;gap:4px;background:#f1f5f9;padding:4px;border-radius:12px}
  .nav-tab{padding:8px 16px;border-radius:8px;border:none;background:transparent;cursor:pointer;font-weight:500;color:#64748b;transition:all 0.2s}
  .nav-tab.active{background:white;color:#1e293b;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
  .nav-tab:hover:not(.active){color:#1e293b}
  
  .header-actions{display:flex;gap:12px;align-items:center}
  .user-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:white;font-weight:600}
  
  /* Main Container */
  .main-container{max-width:1400px;margin:0 auto;padding:24px}
  .content-area{display:none}
  .content-area.active{display:block}
  
  /* Panel Styles */
  .main{max-width:100%;margin:auto;display:flex;flex-direction:column;gap:16px}
  .panel{background:var(--card);border-radius:16px;padding:24px;box-shadow:var(--shadow);margin-bottom:16px}
  h1{margin:0;font-size:24px;color:#1e293b;font-weight:700}
  h2{margin:20px 0 12px 0;font-size:18px;color:var(--accent);font-weight:600}
  h3{margin:16px 0 12px 0;font-size:16px;color:#374151;font-weight:600}
  h4{margin:12px 0 8px 0;font-size:14px;color:var(--accent);font-weight:600}
  
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .btn{border:0;padding:10px 20px;border-radius:10px;cursor:pointer;font-weight:500;transition:all 0.2s;display:inline-flex;align-items:center;gap:8px}
  .btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.success{background:var(--success);color:#fff}
  .btn.ghost{background:#f1f5f9;color:#475569}
  .btn.warning{background:var(--warning);color:#fff}
  .btn.danger{background:var(--danger);color:#fff}
  .btn.small{padding:6px 12px;font-size:13px}
  .btn.icon{padding:8px;width:36px;height:36px;justify-content:center}
  
  /* Navigation with Dropdown */
  .nav-tabs{display:flex;gap:4px;background:#f1f5f9;padding:4px;border-radius:12px;}
  .nav-item{position:relative;}
  .nav-tab{padding:8px 16px;border-radius:8px;border:none;background:transparent;cursor:pointer;font-weight:500;color:#64748b;transition:all 0.2s;white-space:nowrap;font-size:14px;display:flex;align-items:center;gap:4px;}
  .nav-tab:hover{background:white;color:#1e293b;box-shadow:0 1px 3px rgba(0,0,0,0.1);}
  .nav-tab.active{background:white;color:#1e293b;box-shadow:0 1px 3px rgba(0,0,0,0.1);}
  .dropdown{position:absolute;top:100%;left:50%;transform:translateX(-50%);background:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.15);padding:8px;min-width:200px;opacity:0;visibility:hidden;transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none;z-index:1000;}
  .dropdown.active{opacity:1;visibility:visible;pointer-events:all;}
  .nav-item:hover .dropdown{opacity:1;visibility:visible;pointer-events:all;}
  .dropdown-item{padding:10px 16px;border-radius:8px;cursor:pointer;transition:all 0.2s;font-size:13px;color:#475569;display:block;}
  .dropdown-item:hover{background:#f8fafc;color:#1e293b;transform:translateX(4px);}

  .relationship .dropdown-item:hover{background:linear-gradient(to right,#3b82f615,#06b6d415);color:#3b82f6}
  .difference .dropdown-item:hover{background:linear-gradient(to right,#8b5cf615,#a855f715);color:#8b5cf6}
  .assumption .dropdown-item:hover{background:linear-gradient(to right,#10b98115,#05966915);color:#10b981}
  .multivariate .dropdown-item:hover{background:linear-gradient(to right,#f59e0b15,#f9731615);color:#f59e0b}
  .specialized .dropdown-item:hover{background:linear-gradient(to right,#ef444415,#f8717115);color:#ef4444}

  .header-actions{display:flex;gap:12px;align-items:center}
  .user-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:white;font-weight:600}
  .btn{border:0;padding:10px 20px;border-radius:10px;cursor:pointer;font-weight:500;transition:all 0.2s;display:inline-flex;align-items:center;gap:8px}
  .btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.ghost{background:#f1f5f9;color:#475569}
  .btn.small{padding:6px 12px;font-size:13px}
  .btn.icon{padding:8px;width:36px;height:36px;justify-content:center}

  @media (max-width: 768px) {
    .header-content{padding:0 16px}
    .nav-tabs{display:none}
  }

  /* Table with Scrollbar */
  .table-container{
    overflow-x:auto;
    overflow-y:auto;
    max-height:400px;
    border-radius:8px;
    border:1px solid #e2e8f0;
    margin-top:12px;
  }
  table{width:100%;border-collapse:collapse;font-size:13px;min-width:600px;}
  th,td{padding:10px 12px;border-bottom:1px solid #e2e8f0;text-align:center}
  th{background:#f8fafc;font-weight:600;color:#475569;position:sticky;top:0;z-index:1}
  tr:hover{background:#f8fafc}
  
  .muted{color:var(--muted);font-size:13px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
  .grid-4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:16px}
  
  /* Model Cards */
  .model-card {
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    background: white;
  }
  .model-card:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }
  .model-card.selected {
    border-color: var(--accent);
    background: #f0f9ff;
  }
  .model-card h4 {
    margin: 0 0 12px 0;
    color: var(--accent);
    font-size: 18px;
  }
  .model-card .desc {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.5;
  }
  
  /* Enhanced Forms */
  select,input[type="text"],input[type="number"],input[type="checkbox"]{
    padding:8px 12px;
    border:2px solid #e2e8f0;
    border-radius:8px;
    font-size:14px;
    background:white;
    cursor:pointer;
  }
  select:focus,input[type="text"]:focus,input[type="number"]:focus{
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 3px rgba(59,130,246,0.1);
  }
  
  .hypothesis-box{
    background:#f8fafc;border-left:4px solid var(--accent);padding:16px;margin:16px 0;
    border-radius:0 8px 8px 0;
  }
  .interpretation-box{
    background:#f0fdf4;border-left:4px solid var(--success);padding:20px;margin:20px 0;
    border-radius:0 8px 8px 0;
  }
  .interpretation-box.warning{
    background:#fef3c7;border-left-color:var(--warning);
  }
  .interpretation-box.info{
    background:#f0f9ff;border-left-color:var(--info);
  }
  .interpretation-box.reject{
    background:#fef2f2;border-left-color:var(--danger);
  }
  .interpretation-box.accept{
    background:#f0fdf4;border-left-color:var(--success);
  }
  
  .normality-indicator{
    display:inline-block;padding:4px 8px;border-radius:6px;font-weight:600;
    color:white;margin-left:8px;
  }
  .normal{background:var(--success);}
  .non-normal{background:var(--danger);}
  
  .assumption-check{
    background:#fffbeb;border:1px solid #fed7aa;padding:20px;border-radius:12px;margin:16px 0;
  }
  
  .sig{color:var(--success);font-weight:700;}
  .nsig{color:var(--danger);font-weight:700;}
  
  .plot-container{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:20px;
    margin-top:20px;
  }
  .plot-full{
    grid-column:1/-1;
  }
  .plot-item{
    height:350px;
    width:100%;
    border-radius:8px;
    border:1px solid #e2e8f0;
    overflow:hidden;
  }
  
  .stat-card{
    background:#f8fafc;padding:16px;border-radius:8px;text-align:center;border:1px solid #e2e8f0;
  }
  .stat-card .value{font-size:18px;font-weight:700;color:var(--accent);}
  .stat-card .label{font-size:12px;color:var(--muted);margin-top:4px;}
  
  .test-result-row{
    background:#f9fafb;
  }
  .test-result-row.significant{
    background:#fef2f2;
  }
  .test-result-row.not-significant{
    background:#f0fdf4;
  }
  
  .variable-selection{
    background:#f8fafc;
    padding:16px;
    border-radius:8px;
    border:1px solid #e2e8f0;
    margin:12px 0;
  }
  
  .var-checkbox-container{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    margin-top:12px;
  }
  
  .var-checkbox-item{
    display:flex;
    align-items:center;
    gap:6px;
    padding:6px 12px;
    background:white;
    border:1px solid #e2e8f0;
    border-radius:6px;
    cursor:pointer;
    transition:all 0.2s;
  }
  
  .var-checkbox-item:hover{
    border-color:var(--accent);
    background:#f0f9ff;
  }
  
  .var-checkbox-item input[type="checkbox"]{
    margin:0;
    padding:0;
    width:16px;
    height:16px;
  }
  
  @media (max-width: 768px) {
    .header-content{padding:0 16px}
    .nav-tabs{display:none}
    .main-container{padding:16px}
    .grid-2, .grid-3, .grid-4 {
      grid-template-columns: 1fr;
    }
    .plot-container{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<!-- Header Navigation -->
<div class="header">
  <div class="header-content">
    <div class="logo">
      <div class="logo-icon">üìä</div>
      <span>Skari</span>
    </div>

        
        <div class="nav-tabs">
          <!-- 1. Descriptive Statistics -->
          <div class="nav-item descriptives">
            <button class="nav-tab" onclick="selectAnalysis('descriptive.html')">üìä Descriptive</button>
          </div>
        
          <div class="nav-item assumption">
            <button class="nav-tab">üîç Assumption Check <span style="font-size:10px">‚ñº</span></button>
            <div class="dropdown">
              <div class="dropdown-item" onclick="selectAnalysis('normality.html')">Normality Test</div>
              <div class="dropdown-item" onclick="selectAnalysis('homogeneity.html')">Homogeneity Test</div>
            </div>
          </div>
    
    
    
          <!-- 2. Difference Tests -->
          <div class="nav-item difference">
            <button class="nav-tab">‚öñÔ∏è Difference Tests <span style="font-size:10px">‚ñº</span></button>
            <div class="dropdown">
              <div class="dropdown-item" onclick="selectAnalysis('t_test.html')">t-Test</div>
              <div class="dropdown-item" onclick="selectAnalysis('anova.html')">ANOVA</div>
              <div class="dropdown-item" onclick="selectAnalysis('chi_square.html')">Chi-square Test</div>
              <div class="dropdown-item" onclick="selectAnalysis('nonparametric.html')">Nonparametric Tests</div>
            </div>
          </div>
        
          <!-- 3. Relationship Analysis -->
          <div class="nav-item relationship">
            <button class="nav-tab">üìà Relationship <span style="font-size:10px">‚ñº</span></button>
            <div class="dropdown">
              <div class="dropdown-item" onclick="selectAnalysis('correlation.html')">Correlation Analysis</div>
              <div class="dropdown-item" onclick="selectAnalysis('regression.html')">Regression Analysis</div>
            </div>
          </div>
        
          <!-- 4. Multivariate Analysis -->
          <div class="nav-item multivariate">
            <button class="nav-tab">üéØ Multivariate <span style="font-size:10px">‚ñº</span></button>
            <div class="dropdown">
              <div class="dropdown-item" onclick="selectAnalysis('EFA.html')">EFA</div>
              <div class="dropdown-item" onclick="selectAnalysis('CFA.html')">CFA</div>
              <div class="dropdown-item" onclick="selectAnalysis('cluster.html')">Cluster Analysis</div>
              <div class="dropdown-item" onclick="selectAnalysis('discriminant.html')">Discriminant Analysis</div>
              <div class="dropdown-item" onclick="selectAnalysis('pca.html')">PCA</div>
              <div class="dropdown-item" onclick="selectAnalysis('mds.html')">MDS</div>
              <div class="dropdown-item" onclick="selectAnalysis('correspondence.html')">Correspondence Analysis</div>
            </div>
          </div>
        
               
        
          <!-- 6. Specialized Analyses -->
          <div class="nav-item specialized">
            <button class="nav-tab">üî¨ Specialized <span style="font-size:10px">‚ñº</span></button>
            <div class="dropdown">
              <div class="dropdown-item" onclick="selectAnalysis('survival.html')">Survival Analysis</div>
              <div class="dropdown-item" onclick="selectAnalysis('timeseries.html')">Time Series Analysis (ARIMA, etc.)</div>
            </div>
          </div>
        </div>
    
    <div class="header-actions">
      <button class="btn ghost icon" onclick="showNotifications()">üîî</button>
      <button class="btn ghost icon" onclick="showSettings()">‚öôÔ∏è</button>
      <button class="btn primary small" onclick="exportResults()">üíæ Export</button>
      <div class="user-avatar">AD</div>
    </div>
  </div>
</div>

<!-- Main Container -->
<div class="main-container">
  <!-- Descriptive Statistics Tab -->
  <div id="descriptive-tab" class="content-area active">
    <div class="main">
      <div class="panel">
        <h1>üìà Descriptive Statistics Analysis</h1>
        <div class="muted">Upload CSV ‚Üí Select Analysis Type ‚Üí Configure Variables ‚Üí Run Analysis</div>
      </div>

      <div class="panel">
        <div class="controls">
          <input id="fileInput" type="file" accept=".csv" style="padding:8px;">
          <button class="btn success" onclick="loadExample()">üìä Load Sample Data</button>
          <button class="btn ghost" onclick="resetAll()">üîÑ Reset</button>
          <button class="btn ghost" onclick="showHelp()">‚ùì Help</button>
        </div>
        <div id="dataPreview"></div>
      </div>

      <div class="panel" id="analysisTypePanel" style="display:none;">
        <h2>üìà Analysis Type Selection</h2>
        <div class="grid-3">
          <div class="model-card" onclick="selectAnalysis('basic')" id="card-basic">
            <h4>üìä Basic Statistics</h4>
            <div class="desc">‚Ä¢ Mean, Median, Mode<br>‚Ä¢ Standard deviation<br>‚Ä¢ Min, Max, Range</div>
          </div>
          <div class="model-card" onclick="selectAnalysis('distribution')" id="card-distribution">
            <h4>üìà Distribution Analysis</h4>
            <div class="desc">‚Ä¢ Skewness & Kurtosis<br>‚Ä¢ Normality tests<br>‚Ä¢ Q-Q plots</div>
          </div>
          <div class="model-card" onclick="selectAnalysis('outlier')" id="card-outlier">
            <h4>üéØ Outlier Detection</h4>
            <div class="desc">‚Ä¢ IQR method<br>‚Ä¢ Z-score method<br>‚Ä¢ Box plots</div>
          </div>
        </div>
        <div class="grid-3" style="margin-top:16px;">
          <div class="model-card" onclick="selectAnalysis('comparison')" id="card-comparison">
            <h4>‚öñÔ∏è Group Comparison</h4>
            <div class="desc">‚Ä¢ Compare by groups<br>‚Ä¢ Side-by-side plots<br>‚Ä¢ Statistical tests</div>
          </div>
          <div class="model-card" onclick="selectAnalysis('categorical')" id="card-categorical">
            <h4>üìã Categorical Analysis</h4>
            <div class="desc">‚Ä¢ Frequency tables<br>‚Ä¢ Chi-square test<br>‚Ä¢ Bar charts</div>
          </div>
          <div class="model-card" onclick="selectAnalysis('comprehensive')" id="card-comprehensive">
            <h4>üîç Comprehensive</h4>
            <div class="desc">‚Ä¢ All statistics<br>‚Ä¢ Correlation matrix<br>‚Ä¢ Full report</div>
          </div>
        </div>
      </div>

      <div class="panel" id="varPanel" style="display:none;">
        <h2>üéõÔ∏è Variable Configuration</h2>
        
        <div id="varSettings"></div>
        
        <!-- Analysis Options -->
        <div class="grid-3" style="margin-top:20px;">
          <div>
            <div style="margin-bottom:4px;font-weight:500;">Confidence Level</div>
            <select id="confidenceLevel">
              <option value="0.95">95%</option>
              <option value="0.99">99%</option>
              <option value="0.90">90%</option>
            </select>
          </div>
          <div>
            <div style="margin-bottom:4px;font-weight:500;">Missing Data Treatment</div>
            <select id="missingData">
              <option value="exclude">Exclude (listwise deletion)</option>
              <option value="pairwise">Pairwise deletion</option>
              <option value="mean">Replace with mean</option>
              <option value="median">Replace with median</option>
            </select>
          </div>
          <div id="analysisOptions"></div>
        </div>

        <div class="controls" style="margin-top:24px;">
          <button class="btn primary" onclick="runAnalysis()">üöÄ Run Analysis</button>
          <button class="btn ghost" onclick="saveConfiguration()">üíæ Save Config</button>
        </div>
      </div>

      <div class="panel" id="resultsPanel" style="display:none;">
        <h2>üìà Analysis Results</h2>
        
        <!-- Summary Statistics -->
        <div id="summarySection"></div>
        
        <!-- Distribution Analysis -->
        <div id="distributionSection"></div>
        
        <!-- Visualizations -->
        <div class="plot-container">
          <div id="histogramPlot" class="plot-item" style="display:none;"></div>
          <div id="boxPlot" class="plot-item" style="display:none;"></div>
        </div>
        
        <div id="qqPlot" class="plot-item plot-full" style="display:none;margin-top:20px;"></div>
        <div id="scatterMatrix" class="plot-item plot-full" style="display:none;margin-top:20px;"></div>
        
        <!-- Additional Analysis -->
        <div id="additionalSection"></div>
        
        <!-- Interpretation -->
        <div id="interpretationSection"></div>
      </div>
    </div>
  </div>
</div>

<script>
// Global variables
var currentData = null;
var selectedAnalysisType = null;
var analysisResults = {};

// Sample Data Generation
function loadExample() {
  var n = 150;
  var example = [];
  
  for (var i = 0; i < n; i++) {
    var groups = ['A', 'B', 'C'];
    var group = groups[Math.floor(i / (n/3))];
    
    // Normal distribution (Box-Muller transform)
    var u1 = Math.random();
    var u2 = Math.random();
    var normal = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2) * 15 + 100;
    
    var skewed = Math.pow(Math.random(), 2) * 100;
    var uniform = Math.random() * 50 + 25;
    var binary = Math.random() > 0.5 ? 'Yes' : 'No';
    var categories = ['Low', 'Medium', 'High'];
    var category = categories[Math.floor(Math.random() * 3)];
    
    example.push({
      id: i + 1,
      group: group,
      normal_var: parseFloat(normal.toFixed(2)),
      skewed_var: parseFloat(skewed.toFixed(2)),
      uniform_var: parseFloat(uniform.toFixed(2)),
      binary: binary,
      category: category,
      value1: parseFloat((normal * 0.8 + Math.random() * 20).toFixed(2)),
      value2: parseFloat((-normal * 0.6 + Math.random() * 30 + 100).toFixed(2))
    });
  }
  
  processData(example);
}

function processData(data) {
  if (!data || data.length === 0) {
    console.error('No data provided');
    return;
  }
  
  if (Array.isArray(data[0])) {
    var headers = data[0];
    var processedData = [];
    for (var i = 1; i < data.length; i++) {
      var row = {};
      headers.forEach(function(header, index) {
        row[header] = data[i][index];
      });
      processedData.push(row);
    }
    currentData = processedData;
  } else {
    currentData = data;
  }
  
  identifyVariableTypes();
  
  var headers = Object.keys(currentData[0]);
  var preview = '<h3>üìã Data Preview</h3>';
  preview += '<div class="table-container">';
  preview += '<table><thead><tr>';
  headers.forEach(function(h) { preview += '<th>' + h + '</th>'; });
  preview += '</tr></thead><tbody>';
  
  currentData.slice(0, 10).forEach(function(r) {
    preview += '<tr>';
    headers.forEach(function(h) { 
      var val = r[h] || '';
      if (typeof val === 'number') val = val.toFixed(2);
      preview += '<td>' + val + '</td>'; 
    });
    preview += '</tr>';
  });
  
  preview += '</tbody></table></div>';
  preview += '<div class="muted" style="margin-top:12px;">üìä Rows: ' + currentData.length + ' | üì¢ Columns: ' + headers.length + '</div>';
  
  document.getElementById('dataPreview').innerHTML = preview;
  document.getElementById('analysisTypePanel').style.display = 'block';
}

function identifyVariableTypes() {
  if (!currentData) return;
  
  var headers = Object.keys(currentData[0]);
  var varTypes = {};
  
  headers.forEach(function(header) {
    var values = currentData.map(function(row) { return row[header]; }).filter(function(v) { return v !== '' && v !== null; });
    var numericValues = values.filter(function(v) { return !isNaN(parseFloat(v)); });
    
    if (numericValues.length / values.length > 0.8) {
      varTypes[header] = 'numeric';
    } else {
      varTypes[header] = 'categorical';
    }
  });
  
  currentData.varTypes = varTypes;
}

function selectAnalysis(type) {
  selectedAnalysisType = type;
  
  document.querySelectorAll('.model-card').forEach(function(card) {
    card.classList.remove('selected');
  });
  document.getElementById('card-' + type).classList.add('selected');
  
  updateVarUI();
  document.getElementById('varPanel').style.display = 'block';
}

function updateVarUI() {
  if (!selectedAnalysisType || !currentData) return;
  
  var headers = Object.keys(currentData[0]);
  var numericVars = headers.filter(function(h) { return currentData.varTypes[h] === 'numeric'; });
  var categoricalVars = headers.filter(function(h) { return currentData.varTypes[h] === 'categorical'; });
  
  var html = '';
  
  if (selectedAnalysisType === 'basic' || selectedAnalysisType === 'comprehensive') {
    html = '<div class="grid-2">' +
      '<div><div style="margin-bottom:8px;font-weight:500;">Numeric Variables</div>' +
      '<div class="var-checkbox-container">';
    numericVars.forEach(function(v) {
      html += '<label><input type="checkbox" class="num-var" value="' + v + '" checked> ' + v + '</label>';
    });
    html += '</div></div>' +
      '<div><div style="margin-bottom:8px;font-weight:500;">Categorical Variables</div>' +
      '<div class="var-checkbox-container">';
    categoricalVars.forEach(function(v) {
      html += '<label><input type="checkbox" class="cat-var" value="' + v + '"> ' + v + '</label>';
    });
    html += '</div></div></div>';
    
  } else if (selectedAnalysisType === 'distribution' || selectedAnalysisType === 'outlier') {
    html = '<div><div style="margin-bottom:8px;font-weight:500;">Select Variables</div>' +
      '<div class="var-checkbox-container">';
    numericVars.forEach(function(v) {
      html += '<label><input type="checkbox" class="analysis-var" value="' + v + '" checked> ' + v + '</label>';
    });
    html += '</div></div>';
    
  } else if (selectedAnalysisType === 'comparison') {
    html = '<div class="grid-2">' +
      '<div><div style="margin-bottom:4px;font-weight:500;">Grouping Variable</div>' +
      '<select id="groupVar">';
    categoricalVars.forEach(function(v) {
      html += '<option value="' + v + '">' + v + '</option>';
    });
    html += '</select></div>' +
      '<div><div style="margin-bottom:8px;font-weight:500;">Variables to Compare</div>' +
      '<div class="var-checkbox-container">';
    numericVars.forEach(function(v) {
      html += '<label><input type="checkbox" class="compare-var" value="' + v + '" checked> ' + v + '</label>';
    });
    html += '</div></div></div>';
    
  } else if (selectedAnalysisType === 'categorical') {
    html = '<div><div style="margin-bottom:8px;font-weight:500;">Select Variables</div>' +
      '<div class="var-checkbox-container">';
    categoricalVars.forEach(function(v) {
      html += '<label><input type="checkbox" class="cat-analysis-var" value="' + v + '" checked> ' + v + '</label>';
    });
    html += '</div></div>';
  }
  
  document.getElementById('varSettings').innerHTML = html;
}

// Statistical Functions
function mean(arr) {
  return arr.reduce(function(a, b) { return a + b; }, 0) / arr.length;
}

function median(arr) {
  var sorted = arr.slice().sort(function(a, b) { return a - b; });
  var mid = Math.floor(sorted.length / 2);
  return sorted.length % 2 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
}

function variance(arr) {
  var m = mean(arr);
  return arr.reduce(function(sum, x) { return sum + Math.pow(x - m, 2); }, 0) / (arr.length - 1);
}

function stddev(arr) {
  return Math.sqrt(variance(arr));
}

function percentile(arr, p) {
  var sorted = arr.slice().sort(function(a, b) { return a - b; });
  var index = (p / 100) * (sorted.length - 1);
  var lower = Math.floor(index);
  var upper = Math.ceil(index);
  var weight = index % 1;
  
  if (lower === upper) return sorted[lower];
  return sorted[lower] * (1 - weight) + sorted[upper] * weight;
}

function skewness(arr) {
  var n = arr.length;
  var m = mean(arr);
  var s = stddev(arr);
  
  var sum = 0;
  for (var i = 0; i < n; i++) {
    sum += Math.pow((arr[i] - m) / s, 3);
  }
  
  return (n / ((n - 1) * (n - 2))) * sum;
}

function kurtosis(arr) {
  var n = arr.length;
  var m = mean(arr);
  var s = stddev(arr);
  
  var sum = 0;
  for (var i = 0; i < n; i++) {
    sum += Math.pow((arr[i] - m) / s, 4);
  }
  
  return (n * (n + 1) / ((n - 1) * (n - 2) * (n - 3))) * sum - 
         (3 * Math.pow(n - 1, 2) / ((n - 2) * (n - 3)));
}

function detectOutliers(arr) {
  var q1 = percentile(arr, 25);
  var q3 = percentile(arr, 75);
  var iqrVal = q3 - q1;
  var lowerBound = q1 - 1.5 * iqrVal;
  var upperBound = q3 + 1.5 * iqrVal;
  
  var outliers = arr.filter(function(v) { return v < lowerBound || v > upperBound; });
  return {
    outliers: outliers,
    lowerBound: lowerBound,
    upperBound: upperBound,
    count: outliers.length,
    percentage: (outliers.length / arr.length) * 100
  };
}

function analyzeBasicStats(variable) {
  var values = currentData
    .map(function(row) { return parseFloat(row[variable]); })
    .filter(function(v) { return !isNaN(v); });
  
  if (values.length === 0) return null;
  
  var n = values.length;
  var missing = currentData.length - n;
  var m = mean(values);
  var med = median(values);
  var std = stddev(values);
  var vari = variance(values);
  var min = Math.min.apply(null, values);
  var max = Math.max.apply(null, values);
  var range = max - min;
  var q1 = percentile(values, 25);
  var q3 = percentile(values, 75);
  var iqrVal = q3 - q1;
  var skew = skewness(values);
  var kurt = kurtosis(values);
  var cv = (std / m) * 100;
  var se = std / Math.sqrt(n);
  
  var confidence = parseFloat(document.getElementById('confidenceLevel').value);
  var zScore = confidence === 0.99 ? 2.576 : confidence === 0.95 ? 1.96 : 1.645;
  var ci = [m - zScore * se, m + zScore * se];
  
  return {
    n: n, missing: missing, mean: m, median: med, std: std, variance: vari,
    min: min, max: max, range: range, q1: q1, q3: q3, iqr: iqrVal, 
    percentile5: percentile(values, 5),
    percentile95: percentile(values, 95),
    skewness: skew, kurtosis: kurt, cv: cv, se: se, ci: ci,
    values: values
  };
}

function analyzeCategorical(variable) {
  var values = currentData
    .map(function(row) { return row[variable]; })
    .filter(function(v) { return v !== '' && v !== null; });
  
  var freq = {};
  values.forEach(function(v) { freq[v] = (freq[v] || 0) + 1; });
  
  var total = values.length;
  var categories = Object.keys(freq);
  var counts = Object.values(freq);
  
  var expected = total / categories.length;
  var chiSquare = 0;
  counts.forEach(function(observed) {
    chiSquare += Math.pow(observed - expected, 2) / expected;
  });
  
  var df = categories.length - 1;
  var pValue = chiSquare > 10 ? 0.01 : chiSquare > 5 ? 0.05 : 0.1;
  
  return {
    total: total,
    missing: currentData.length - total,
    categories: categories.length,
    frequency: freq,
    mode: categories.reduce(function(a, b) { return freq[a] > freq[b] ? a : b; }),
    chiSquare: chiSquare,
    df: df,
    pValue: pValue,
    uniform: pValue > 0.05
  };
}

function runAnalysis() {
  if (!selectedAnalysisType || !currentData) {
    alert('Please select an analysis type and load data first.');
    return;
  }
  
  analysisResults = {};
  var html = '';
  var interpretationHtml = '';
  
  var type = selectedAnalysisType;
  
  if (type === 'basic' || type === 'comprehensive') {
    var numVars = Array.from(document.querySelectorAll('.num-var:checked')).map(function(cb) { return cb.value; });
    var catVars = Array.from(document.querySelectorAll('.cat-var:checked')).map(function(cb) { return cb.value; });
    
    html = '<h3>' + (type === 'basic' ? 'Basic' : 'Comprehensive') + ' Statistics</h3>';
    
    if (numVars.length > 0) {
      html += '<div class="table-container">';
      html += '<table><thead><tr><th>Variable</th><th>N</th><th>Mean</th><th>Median</th><th>Std Dev</th><th>Min</th><th>Max</th>';
      if (type === 'comprehensive') {
        html += '<th>Skewness</th><th>Kurtosis</th>';
      }
      html += '</tr></thead><tbody>';
      
      numVars.forEach(function(v) {
        var stats = analyzeBasicStats(v);
        if (stats) {
          analysisResults[v] = stats;
          html += '<tr><td>' + v + '</td><td>' + stats.n + '</td><td>' + stats.mean.toFixed(2) + '</td>';
          html += '<td>' + stats.median.toFixed(2) + '</td><td>' + stats.std.toFixed(2) + '</td>';
          html += '<td>' + stats.min.toFixed(2) + '</td><td>' + stats.max.toFixed(2) + '</td>';
          if (type === 'comprehensive') {
            html += '<td>' + stats.skewness.toFixed(3) + '</td><td>' + stats.kurtosis.toFixed(3) + '</td>';
          }
          html += '</tr>';
          
          interpretationHtml += interpretBasicStats(stats, v);
          if (type === 'comprehensive') {
            interpretationHtml += interpretDistribution(stats, v);
          }
        }
      });
      html += '</tbody></table></div>';
      
      createVisualization(numVars);
    }
    
    if (catVars.length > 0) {
      html += '<h4>Categorical Variables</h4>';
      catVars.forEach(function(v) {
        var stats = analyzeCategorical(v);
        if (stats) {
          html += '<div class="summary-box"><h4>' + v + '</h4>';
          html += '<div class="table-container">';
          html += '<table><thead><tr><th>Category</th><th>Frequency</th><th>%</th></tr></thead><tbody>';
          Object.entries(stats.frequency).forEach(function(entry) {
            var cat = entry[0];
            var freq = entry[1];
            html += '<tr><td>' + cat + '</td><td>' + freq + '</td><td>' + (freq/stats.total*100).toFixed(1) + '%</td></tr>';
          });
          html += '</tbody></table></div></div>';
          
          interpretationHtml += interpretCategorical(stats, v);
        }
      });
    }
    
  } else if (type === 'distribution') {
    var vars = Array.from(document.querySelectorAll('.analysis-var:checked')).map(function(cb) { return cb.value; });
    html = '<h3>Distribution Analysis</h3>';
    html += '<div class="table-container">';
    html += '<table><thead><tr><th>Variable</th><th>Skewness</th><th>Kurtosis</th><th>Normality</th></tr></thead><tbody>';
    
    vars.forEach(function(v) {
      var stats = analyzeBasicStats(v);
      if (stats) {
        var normal = Math.abs(stats.skewness) < 0.5 && Math.abs(stats.kurtosis) < 0.5;
        html += '<tr><td>' + v + '</td><td>' + stats.skewness.toFixed(3) + '</td>';
        html += '<td>' + stats.kurtosis.toFixed(3) + '</td>';
        html += '<td>' + (normal ? '‚úì Normal' : '‚úó Non-normal') + '</td></tr>';
        
        interpretationHtml += interpretDistribution(stats, v);
      }
    });
    html += '</tbody></table></div>';
    
  } else if (type === 'outlier') {
    var vars = Array.from(document.querySelectorAll('.analysis-var:checked')).map(function(cb) { return cb.value; });
    html = '<h3>Outlier Detection</h3>';
    
    vars.forEach(function(v) {
      var stats = analyzeBasicStats(v);
      if (stats) {
        var outliers = detectOutliers(stats.values);
        html += '<div class="outlier-box"><h4>' + v + '</h4>';
        html += '<div>Outliers: ' + outliers.count + ' (' + outliers.percentage.toFixed(1) + '%)</div>';
        html += '<div>Bounds: [' + outliers.lowerBound.toFixed(2) + ', ' + outliers.upperBound.toFixed(2) + ']</div></div>';
        
        interpretationHtml += interpretOutliers(outliers, v);
      }
    });
  }
  
  document.getElementById('summarySection').innerHTML = html;
  document.getElementById('interpretationSection').innerHTML = interpretationHtml;
  document.getElementById('resultsPanel').style.display = 'block';
}

function interpretBasicStats(stats, varName) {
  var interpretation = '<div class="interpretation-box info">';
  interpretation += '<h4>üìä Interpretation for ' + varName + '</h4>';
  
  var meanMedianDiff = Math.abs(stats.mean - stats.median);
  var relDiff = (meanMedianDiff / stats.mean) * 100;
  
  if (relDiff < 5) {
    interpretation += '<p>‚Ä¢ <strong>Central Tendency:</strong> The mean (' + stats.mean.toFixed(2) + ') and median (' + stats.median.toFixed(2) + ') are similar, suggesting a symmetric distribution.</p>';
  } else if (stats.mean > stats.median) {
    interpretation += '<p>‚Ä¢ <strong>Central Tendency:</strong> The mean (' + stats.mean.toFixed(2) + ') is higher than the median (' + stats.median.toFixed(2) + '), indicating a right-skewed distribution.</p>';
  } else {
    interpretation += '<p>‚Ä¢ <strong>Central Tendency:</strong> The mean (' + stats.mean.toFixed(2) + ') is lower than the median (' + stats.median.toFixed(2) + '), indicating a left-skewed distribution.</p>';
  }
  
  if (stats.cv < 15) {
    interpretation += '<p>‚Ä¢ <strong>Variability:</strong> Low coefficient of variation (' + stats.cv.toFixed(1) + '%) indicates data points are clustered closely around the mean.</p>';
  } else if (stats.cv < 30) {
    interpretation += '<p>‚Ä¢ <strong>Variability:</strong> Moderate coefficient of variation (' + stats.cv.toFixed(1) + '%) shows moderate spread in the data.</p>';
  } else {
    interpretation += '<p>‚Ä¢ <strong>Variability:</strong> High coefficient of variation (' + stats.cv.toFixed(1) + '%) indicates substantial spread in the data.</p>';
  }
  
  interpretation += '<p>‚Ä¢ <strong>Confidence Interval:</strong> 95% confident that the true population mean falls between ' + stats.ci[0].toFixed(2) + ' and ' + stats.ci[1].toFixed(2) + '.</p>';
  interpretation += '</div>';
  return interpretation;
}

function interpretDistribution(stats, varName) {
  var interpretation = '<div class="interpretation-box ';
  var isNormal = Math.abs(stats.skewness) < 0.5 && Math.abs(stats.kurtosis) < 0.5;
  
  interpretation += isNormal ? 'success">' : 'warning">';
  interpretation += '<h4>üìà Distribution Analysis for ' + varName + '</h4>';
  
  if (Math.abs(stats.skewness) < 0.5) {
    interpretation += '<p>‚Ä¢ <strong>Skewness (' + stats.skewness.toFixed(3) + '):</strong> The distribution is approximately symmetric.</p>';
  } else if (stats.skewness > 0.5) {
    interpretation += '<p>‚Ä¢ <strong>Skewness (' + stats.skewness.toFixed(3) + '):</strong> Positive skewness - longer tail on the right side.</p>';
  } else {
    interpretation += '<p>‚Ä¢ <strong>Skewness (' + stats.skewness.toFixed(3) + '):</strong> Negative skewness - longer tail on the left side.</p>';
  }
  
  if (Math.abs(stats.kurtosis) < 0.5) {
    interpretation += '<p>‚Ä¢ <strong>Kurtosis (' + stats.kurtosis.toFixed(3) + '):</strong> Normal peak and tail behavior (mesokurtic).</p>';
  } else if (stats.kurtosis > 0.5) {
    interpretation += '<p>‚Ä¢ <strong>Kurtosis (' + stats.kurtosis.toFixed(3) + '):</strong> Heavy-tailed distribution with more extreme values.</p>';
  } else {
    interpretation += '<p>‚Ä¢ <strong>Kurtosis (' + stats.kurtosis.toFixed(3) + '):</strong> Light-tailed distribution with fewer extreme values.</p>';
  }
  
  if (isNormal) {
    interpretation += '<p>‚Ä¢ <strong>Normality:</strong> ‚úÖ Data appears normally distributed. Parametric tests are appropriate.</p>';
  } else {
    interpretation += '<p>‚Ä¢ <strong>Normality:</strong> ‚ö†Ô∏è Data deviates from normality. Consider non-parametric tests.</p>';
  }
  
  interpretation += '</div>';
  return interpretation;
}

function interpretOutliers(outliers, varName) {
  var interpretation = '<div class="interpretation-box ';
  
  if (outliers.percentage < 1) {
    interpretation += 'success">';
  } else if (outliers.percentage < 5) {
    interpretation += 'info">';
  } else {
    interpretation += 'warning">';
  }
  
  interpretation += '<h4>üéØ Outlier Detection for ' + varName + '</h4>';
  
  if (outliers.count === 0) {
    interpretation += '<p>‚Ä¢ <strong>No Outliers:</strong> All data points fall within the expected range.</p>';
  } else if (outliers.percentage < 1) {
    interpretation += '<p>‚Ä¢ <strong>Minimal Outliers:</strong> ' + outliers.count + ' outliers (' + outliers.percentage.toFixed(1) + '%) detected - within acceptable limits.</p>';
  } else if (outliers.percentage < 5) {
    interpretation += '<p>‚Ä¢ <strong>Moderate Outliers:</strong> ' + outliers.count + ' outliers (' + outliers.percentage.toFixed(1) + '%) detected - review may be warranted.</p>';
  } else {
    interpretation += '<p>‚Ä¢ <strong>Significant Outliers:</strong> ' + outliers.count + ' outliers (' + outliers.percentage.toFixed(1) + '%) detected - data quality review recommended.</p>';
  }
  
  interpretation += '<p>‚Ä¢ <strong>Normal Range:</strong> ' + outliers.lowerBound.toFixed(2) + ' to ' + outliers.upperBound.toFixed(2) + '</p>';
  interpretation += '</div>';
  return interpretation;
}

function interpretCategorical(stats, varName) {
  var interpretation = '<div class="interpretation-box info">';
  interpretation += '<h4>üìã Categorical Analysis for ' + varName + '</h4>';
  
  interpretation += '<p>‚Ä¢ <strong>Categories:</strong> ' + stats.categories + ' unique categories</p>';
  interpretation += '<p>‚Ä¢ <strong>Mode:</strong> Most frequent category is "' + stats.mode + '"</p>';
  
  if (stats.uniform) {
    interpretation += '<p>‚Ä¢ <strong>Distribution:</strong> ‚úÖ Categories are uniformly distributed (p = ' + stats.pValue.toFixed(4) + ')</p>';
  } else {
    interpretation += '<p>‚Ä¢ <strong>Distribution:</strong> ‚ö†Ô∏è Categories show significant imbalance (p = ' + stats.pValue.toFixed(4) + ')</p>';
  }
  
  var maxFreq = Math.max.apply(null, Object.values(stats.frequency));
  var concentration = (maxFreq / stats.total) * 100;
  
  if (concentration > 50) {
    interpretation += '<p>‚Ä¢ <strong>Concentration:</strong> High - ' + concentration.toFixed(1) + '% in single category</p>';
  } else {
    interpretation += '<p>‚Ä¢ <strong>Concentration:</strong> Well-balanced distribution</p>';
  }
  
  interpretation += '</div>';
  return interpretation;
}

function createVisualization(variables) {
  if (variables.length === 0) return;
  
  var firstVar = variables[0];
  var stats = analysisResults[firstVar];
  if (!stats || !stats.values) return;
  
  document.getElementById('histogramPlot').style.display = 'block';
  var histData = [{
    x: stats.values,
    type: 'histogram',
    marker: { color: '#3b82f6' }
  }];
  
  var histLayout = {
    title: { text: 'Distribution of ' + firstVar, font: { size: 16 } },
    xaxis: { title: firstVar },
    yaxis: { title: 'Frequency' },
    plot_bgcolor: '#f8fafc',
    paper_bgcolor: 'white',
    margin: { l: 60, r: 20, t: 60, b: 60 },
    autosize: true
  };
  
  document.getElementById('boxPlot').style.display = 'block';
  var boxData = variables.map(function(v) {
    var s = analysisResults[v];
    if (s && s.values) {
      return {
        y: s.values,
        type: 'box',
        name: v
      };
    }
  }).filter(function(d) { return d; });
  
  var boxLayout = {
    title: { text: 'Box Plots', font: { size: 16 } },
    yaxis: { title: 'Value' },
    plot_bgcolor: '#f8fafc',
    paper_bgcolor: 'white',
    margin: { l: 60, r: 20, t: 60, b: 60 },
    autosize: true
  };
  
  setTimeout(function() {
    Plotly.newPlot('histogramPlot', histData, histLayout, {displayModeBar: false, responsive: true});
    if (boxData.length > 0) {
      Plotly.newPlot('boxPlot', boxData, boxLayout, {displayModeBar: false, responsive: true});
    }
  }, 100);
}

// Navigation and utility functions
function switchTab(tab) {
  document.querySelectorAll('.content-area').forEach(function(area) {
    area.classList.remove('active');
  });
  if (document.getElementById(tab + '-tab')) {
    document.getElementById(tab + '-tab').classList.add('active');
  }
  document.querySelectorAll('.nav-tab').forEach(function(navTab) {
    navTab.classList.remove('active');
  });
  if (event && event.target) {
    event.target.classList.add('active');
  }
}

function showNotifications() {
  alert('üîî Notifications:\n\n‚Ä¢ Descriptive analysis completed\n‚Ä¢ Statistics calculated\n‚Ä¢ Visualizations generated\n‚Ä¢ Interpretations provided');
}

function showSettings() {
  alert('‚öôÔ∏è Settings:\n\n‚Ä¢ Multiple analysis types\n‚Ä¢ Confidence level options\n‚Ä¢ Missing data handling\n‚Ä¢ Comprehensive reporting');
}

function exportResults() {
  if (Object.keys(analysisResults).length > 0) {
    var data = JSON.stringify(analysisResults, null, 2);
    var blob = new Blob([data], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'descriptive-statistics-results.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  } else {
    alert('No results to export. Please run an analysis first.');
  }
}

function showHelp() {
  alert('üìà Descriptive Statistics Guide:\n\n‚Ä¢ Basic: Mean, median, standard deviation\n‚Ä¢ Distribution: Skewness, kurtosis, normality\n‚Ä¢ Outliers: IQR method, Z-score detection\n‚Ä¢ Comparison: Group-by-group analysis\n‚Ä¢ Categorical: Frequency tables, chi-square\n‚Ä¢ Comprehensive: All statistics combined\n\nInterpretation includes practical insights for each measure.');
}

function saveConfiguration() {
  var config = {
    analysisType: selectedAnalysisType,
    confidence: document.getElementById('confidenceLevel').value,
    missing: document.getElementById('missingData').value
  };
  
  localStorage.setItem('descriptiveConfig', JSON.stringify(config));
  alert('‚úÖ Configuration saved successfully!');
}

function resetAll() {
  currentData = null;
  selectedAnalysisType = null;
  analysisResults = {};
  
  document.getElementById('dataPreview').innerHTML = '';
  document.getElementById('analysisTypePanel').style.display = 'none';
  document.getElementById('varPanel').style.display = 'none';
  document.getElementById('resultsPanel').style.display = 'none';
  document.getElementById('fileInput').value = '';
  
  document.querySelectorAll('.model-card').forEach(function(card) {
    card.classList.remove('selected');
  });
  
  ['histogramPlot', 'boxPlot', 'qqPlot', 'scatterMatrix'].forEach(function(plotId) {
    var plotDiv = document.getElementById(plotId);
    if (plotDiv && typeof Plotly !== 'undefined') {
      Plotly.purge(plotDiv);
      plotDiv.style.display = 'none';
    }
  });
  
  alert('Descriptive statistics analysis reset successfully!');
}

// CSV File Loading
document.addEventListener('DOMContentLoaded', function() {
  if (document.getElementById('fileInput')) {
    document.getElementById('fileInput').addEventListener('change', function(event) {
      var file = event.target.files[0];
      if (file && file.type === "text/csv") {
        Papa.parse(file, {
          complete: function(results) {
            if (results.data && results.data.length > 1) {
              processData(results.data);
            }
          },
          header: true,
          skipEmptyLines: true,
          dynamicTyping: true
        });
      } else {
        alert('Please select a valid CSV file.');
      }
    });
  }
});
</script>
</body>
</html>
