
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>t-ê²€ì • ì˜¬ì¸ì› ë„êµ¬</title>

<!-- CSV íŒŒì‹± -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<!-- Plotly -->
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

<style>
  :root{
    --bg:#f4f5f7; --card:#ffffff; --muted:#6b7280; --accent:#2563eb; --success:#059669;
    --fail:#9ca3af; --shadow:0 8px 30px rgba(16,24,40,0.06); --warning:#f59e0b; --danger:#ef4444;
  }
  *{box-sizing:border-box}
  body{font-family:"Inter","Segoe UI",Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:#111827;padding:24px;display:flex;gap:20px;min-height:100vh}
  
  /* ì‚¬ì´ë“œë°” */
  .sidebar{width:280px;background:var(--card);border-radius:16px;padding:18px;box-shadow:var(--shadow);height:fit-content;position:sticky;top:24px}
  .sidebar h2{text-align:center;margin-bottom:15px;font-size:18px}
  
  /* ë©”ë‰´ ê°„ê²© ì¡°ì • */
  .menu-category{
    font-size:13px;
    font-weight:700;
    color:var(--muted);
    margin-top:16px;
    margin-bottom:6px;
    padding:0 12px;
    text-transform:uppercase;
    letter-spacing:0.5px;
  }
  
  .menu-category:first-child{
    margin-top:0;
  }
  
  .menu-item{
    display:block;
    padding:10px 12px;
    border-radius:12px;
    color:#374151;
    margin-bottom:3px;
    cursor:pointer;
    transition:all .18s ease;
    font-size:14px;
  }
  
  .menu-item.active{background:var(--accent);color:white;font-weight:600;box-shadow:0 6px 18px rgba(37,99,235,0.14)}
  .menu-item:hover:not(.active){background:#f3f4f6}
  
  /* ë©”ì¸ */
  .main{flex:1;display:flex;flex-direction:column;gap:16px}
  .panel{background:var(--card);border-radius:16px;padding:18px;box-shadow:var(--shadow)}
  h1{margin:0;font-size:22px;color:var(--accent)}
  h3{margin:0 0 15px 0;font-size:16px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .btn{border:0;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:600;font-size:14px;transition:all .15s ease}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.primary:hover{background:#1d4ed8}
  .btn.success{background:var(--success);color:#fff}
  .btn.success:hover{background:#047857}
  .btn.ghost{background:#f3f4f6;color:#111827}
  .btn.ghost:hover{background:#e5e7eb}
  select,input[type="file"],input[type="number"]{padding:8px 12px;border-radius:8px;border:1px solid #d1d5db;margin-top:8px;font-size:14px}
  input[type="file"]{width:auto}
  table{width:100%;border-collapse:collapse;margin-top:12px;font-size:13px}
  th{background:#f9fafb;padding:10px 8px;border-bottom:2px solid #e5e7eb;text-align:center;font-weight:600}
  td{padding:8px;border-bottom:1px solid #f3f4f6;text-align:center}
  .muted{color:var(--muted);font-size:13px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .sig{color:var(--success);font-weight:700;}
  .nsig{color:var(--fail);font-weight:700;}
  label{display:block;font-weight:600;color:#111827;margin-bottom:4px;font-size:14px}
  .mb-2{margin-bottom:12px}
  .section{margin-bottom:15px}
  .inline{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .data-info{background:#f0f9ff;padding:12px;border-radius:8px;margin:10px 0;border:1px solid #e0f2fe}
  .variable-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .variable-tag{background:#e5e7eb;padding:4px 8px;border-radius:6px;font-size:12px}
  .interpretation{background:#f8fafc;border-left:4px solid #64748b;padding:18px;margin-top:20px;border-radius:8px;border:1px solid #e2e8f0}
  .interpretation h4{margin:0 0 12px 0;color:#334155;font-size:16px}
  .status-badge{padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600}
  .status-success{background:#d1fae5;color:#065f46}
  .status-danger{background:#fee2e2;color:#991b1b}
</style>
</head>
<body>
  <!-- ì‚¬ì´ë“œë°” -->
  <div class="sidebar">
    <h2>ğŸ“Š ë¶„ì„ ë©”ë‰´</h2>
    <div id="menuList">
      <div class="menu-category">ë°ì´í„° íƒìƒ‰</div>
      <div class="menu-item" data-target="stats.html">ê¸°ìˆ í†µê³„</div>

      <div class="menu-category">ì§‘ë‹¨ ê°„ ì°¨ì´ ê²€ì •</div>
      <div class="menu-item active" data-target="t_test.html">t-ê²€ì • (ë…ë¦½/ëŒ€ì‘)</div>
      <div class="menu-item" data-target="chisquare.html">ì¹´ì´ì œê³± ê²€ì •</div>
      <div class="menu-item" data-target="main-nonparam">ë¹„ëª¨ìˆ˜ ê²€ì •</div>
      <div class="menu-item" data-target="main-anova">ë¶„ì‚°ë¶„ì„ (ANOVA)</div>

      <div class="menu-category">ë³€ìˆ˜ ê°„ ê´€ê³„ ë¶„ì„</div>
      <div class="menu-item" data-target="main-corr">ìƒê´€ë¶„ì„</div>
      <div class="menu-item" data-target="main-reg">íšŒê·€ë¶„ì„</div>
      <div class="menu-item" data-target="main-probit">í”„ë¡œë¹—ë¶„ì„</div>
      <div class="menu-item" data-target="main-mediation">ë§¤ê°œíš¨ê³¼</div>
      <div class="menu-item" data-target="main-moderation">ì¡°ì ˆíš¨ê³¼</div>
      <div class="menu-item" data-target="main-discriminant">íŒë³„ë¶„ì„</div>
      <div class="menu-item" data-target="main-sem">SEM (êµ¬ì¡°ë°©ì •ì‹ ëª¨í˜•)</div>

      <div class="menu-category">ì°¨ì› ì¶•ì†Œ / êµ°ì§‘í™”</div>
      <div class="menu-item" data-target="main-pca">PCA</div>
      <div class="menu-item" data-target="main-efa">íƒìƒ‰ì  ìš”ì¸ë¶„ì„ (EFA)</div>
      <div class="menu-item" data-target="main-cfa">í™•ì¸ì  ìš”ì¸ë¶„ì„ (CFA)</div>
      <div class="menu-item" data-target="main-cluster">êµ°ì§‘ë¶„ì„</div>
    </div>
  </div>

  <!-- ë©”ì¸ -->
  <div class="main">
    <!-- í—¤ë” -->
    <div class="panel">
      <h1>ğŸ“Š t-ê²€ì • ì˜¬ì¸ì› ë„êµ¬</h1>
      <div class="muted">CSV ì—…ë¡œë“œ â†’ ê²€ì • ì¢…ë¥˜ ì„ íƒ â†’ ë³€ìˆ˜ ì„¤ì • â†’ ì‹¤í–‰</div>
    </div>

    <!-- ë°ì´í„° ì—…ë¡œë“œ -->
    <div class="panel">
      <h3>ë°ì´í„° ì—…ë¡œë“œ</h3>
      <div class="section" style="margin-top:15px">
        <div class="inline">
          <input id="fileInput" type="file" accept=".csv">
          <button class="btn success" onclick="loadExample()">ì˜ˆì œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn ghost" onclick="resetAll()">ì´ˆê¸°í™”</button>
        </div>
        
        <div id="dataInfo" class="data-info" style="display:none">
          <strong>ë°ì´í„° ì •ë³´:</strong>
          <div id="dataDetails"></div>
        </div>
      </div>
      <div id="dataPreview"></div>
    </div>

    <!-- ë¶„ì„ ì„¤ì • -->
    <div class="panel" id="varPanel" style="display:none;">
      <h3>ë¶„ì„ ì„¤ì •</h3>
      <div class="mb-2">
        <label>ê²€ì • ì¢…ë¥˜</label>
        <select id="testType" onchange="updateVarUI()">
          <option value="one">ë‹¨ì¼í‘œë³¸ t-ê²€ì •</option>
          <option value="independent">ë…ë¦½í‘œë³¸ t-ê²€ì • (Student)</option>
          <option value="welch">ë…ë¦½í‘œë³¸ t-ê²€ì • (Welch)</option>
          <option value="paired">ëŒ€ì‘í‘œë³¸ t-ê²€ì •</option>
        </select>
      </div>

      <div id="varSettings"></div>
      <div class="controls">
        <button class="btn primary" onclick="runTtest()">ğŸš€ ë¶„ì„ ì‹¤í–‰</button>
      </div>
    </div>

    <!-- ë¶„ì„ ê²°ê³¼ -->
    <div class="panel" id="resultsPanel" style="display:none;">
      <h3>ë¶„ì„ ê²°ê³¼</h3>
      <div id="resultTables"></div>
      <div id="ttestPlot" style="height:350px;margin-top:20px;"></div>
    </div>

    <!-- ê²°ê³¼ í•´ì„ -->
    <div class="panel" id="interpretationPanel" style="display:none;">
      <h3>ê²°ê³¼ í•´ì„</h3>
      <div id="interpretation"></div>
    </div>
  </div>

<script>
let currentData=null;

// ì˜ˆì œ ë°ì´í„°
function loadExample(){
  const example=[
    {group:"ë‚¨", score:85, pre:70, post:80},
    {group:"ë‚¨", score:78, pre:68, post:74},
    {group:"ë‚¨", score:90, pre:72, post:88},
    {group:"ì—¬", score:88, pre:75, post:85},
    {group:"ì—¬", score:92, pre:77, post:90},
    {group:"ì—¬", score:95, pre:74, post:93}
  ];
  processData(example);
}

// CSV íŒŒì¼ ë¡œë“œ
document.getElementById('fileInput').addEventListener('change', function(event) {
  const file = event.target.files[0];
  if (file && file.type === "text/csv") {
    Papa.parse(file, {
      complete: function(results) {
        processData(results.data.slice(1).map(row => {
          const obj = {};
          results.data[0].forEach((header, index) => {
            obj[header] = row[index];
          });
          return obj;
        }));
      },
      header: false
    });
  }
});

// ë°ì´í„° ì²˜ë¦¬
function processData(data){
  currentData=data;
  const headers=Object.keys(data[0]);
  
  // ë°ì´í„° ì •ë³´ í‘œì‹œ
  showDataInfo(data, headers);
  
  // ë¯¸ë¦¬ë³´ê¸° í…Œì´ë¸”
  let preview='<table><thead><tr>';
  headers.forEach(h=>preview+=`<th>${h}</th>`); 
  preview+='</tr></thead><tbody>';
  data.slice(0,5).forEach(r=>{
    preview+='<tr>';
    headers.forEach(h=>preview+=`<td>${r[h]}</td>`);
    preview+='</tr>';
  });
  preview+='</tbody></table>';
  document.getElementById('dataPreview').innerHTML=preview;
  updateVarUI(headers);
  document.getElementById('varPanel').style.display='block';
}

// ë°ì´í„° ì •ë³´ í‘œì‹œ
function showDataInfo(data, headers) {
  // ìˆ˜ì¹˜í˜•/ë²”ì£¼í˜• ë³€ìˆ˜ ë¶„ë¥˜
  const numericCols = headers.filter(h => 
    data.some(row => row[h] !== null && row[h] !== "" && !isNaN(parseFloat(row[h])))
  );
  const categoricalCols = headers.filter(h => !numericCols.includes(h));
  
  const info = `
    <strong>í–‰ ìˆ˜:</strong> ${data.length} | 
    <strong>ì—´ ìˆ˜:</strong> ${headers.length}<br>
    <strong>ìˆ˜ì¹˜í˜• ë³€ìˆ˜ (${numericCols.length}):</strong> 
    <div class="variable-list">
      ${numericCols.map(col => `<span class="variable-tag">${col}</span>`).join('')}
    </div>
    <strong>ë²”ì£¼í˜• ë³€ìˆ˜ (${categoricalCols.length}):</strong>
    <div class="variable-list">
      ${categoricalCols.map(col => `<span class="variable-tag">${col}</span>`).join('')}
    </div>
  `;
  
  document.getElementById('dataDetails').innerHTML = info;
  document.getElementById('dataInfo').style.display = 'block';
}

// ë³€ìˆ˜ UI ì—…ë°ì´íŠ¸
function updateVarUI(headers=null){
  if(!headers&&currentData) headers=Object.keys(currentData[0]);
  const type=document.getElementById('testType').value;
  let html="";
  
  if(type==="one"){
    html=`<div class="grid-2">
      <div>
        <label>ë¶„ì„ ë³€ìˆ˜</label>
        <select id="oneVar">${headers.map(h=>`<option>${h}</option>`).join('')}</select>
      </div>
      <div>
        <label>ë¹„êµ ê¸°ì¤€ê°’ Î¼â‚€</label>
        <input id="mu0" type="number" value="80">
      </div>
    </div>`;
  }else if(type==="independent"||type==="welch"){
    html=`<div class="grid-2">
      <div>
        <label>ì§‘ë‹¨ ë³€ìˆ˜</label>
        <select id="groupVar">${headers.map(h=>`<option>${h}</option>`).join('')}</select>
      </div>
      <div>
        <label>ë¶„ì„ ë³€ìˆ˜</label>
        <select id="indVar">${headers.map(h=>`<option>${h}</option>`).join('')}</select>
      </div>
    </div>`;
  }else if(type==="paired"){
    html=`<div class="grid-2">
      <div>
        <label>ë³€ìˆ˜ 1 (ì‚¬ì „)</label>
        <select id="pair1">${headers.map(h=>`<option>${h}</option>`).join('')}</select>
      </div>
      <div>
        <label>ë³€ìˆ˜ 2 (ì‚¬í›„)</label>
        <select id="pair2">${headers.map(h=>`<option>${h}</option>`).join('')}</select>
      </div>
    </div>`;
  }
  document.getElementById('varSettings').innerHTML=html;
}

// të¶„í¬ í™•ë¥ ë°€ë„í•¨ìˆ˜
function tPdf(x, df) {
  const gamma1 = Math.exp(logGamma((df + 1) / 2));
  const gamma2 = Math.exp(logGamma(df / 2));
  return (gamma1 / (Math.sqrt(df * Math.PI) * gamma2)) * Math.pow(1 + x * x / df, -(df + 1) / 2);
}

// ê°ë§ˆí•¨ìˆ˜ì˜ ë¡œê·¸
function logGamma(z) {
  if (z < 0.5) {
    return Math.log(Math.PI) - Math.log(Math.sin(Math.PI * z)) - logGamma(1 - z);
  }
  z -= 1;
  let x = 0.99999999999999709182;
  const cof = [57.156235665862923517, -59.597960355475491248, 14.136097974741747174, -0.49191381609762019978, 0.33994649984811888699e-4, 0.46523628927048575665e-4, -0.98374475304879564677e-4, 0.15808870322491248884e-3, -0.21026444172410488319e-3, 0.21743961811521264320e-3, -0.16431810653676389022e-3, 0.84418223983852743293e-4, -0.26190838401581408670e-4, 0.36899182659531622704e-5];
  for (let i = 0; i < cof.length; i++) {
    x += cof[i] / (z + i + 1);
  }
  const t = z + cof.length - 0.5;
  return Math.log(Math.sqrt(2 * Math.PI)) + (z + 0.5) * Math.log(t) - t + Math.log(x);
}

// të¶„í¬ ëˆ„ì ë¶„í¬í•¨ìˆ˜
function tCdf(t, df) {
  if (t === 0) return 0.5;
  
  const x = t / Math.sqrt(df);
  const a = Math.atan(x) / Math.PI + 0.5;
  
  if (df === 1) return a;
  if (df === 2) return 0.5 + x / (2 * Math.sqrt(1 + x * x));
  
  return 0.5 + 0.5 * Math.sign(t) * (1 - Math.exp(-2 * t * t / Math.PI));
}

// ì‹¤í–‰
function runTtest(){
  const type=document.getElementById('testType').value;
  let result="", plotData=[], layout={}, pval=1;
  let testResult = null; // í•´ì„ìš© ê²°ê³¼ ì €ì¥

  if(type==="one"){
    const v=document.getElementById('oneVar').value;
    const mu0=parseFloat(document.getElementById('mu0').value);
    const x=currentData.map(r=>parseFloat(r[v])).filter(n=>!isNaN(n));
    const m=mean(x), s=std(x), n=x.length;
    const t=(m-mu0)/(s/Math.sqrt(n));
    const df=n-1; 
    pval=2*(1-tCdf(Math.abs(t),df));
    const d=(m-mu0)/s;
    
    // í•´ì„ìš© ê²°ê³¼ ì €ì¥
    testResult = {
      type: 'ë‹¨ì¼í‘œë³¸ t-ê²€ì •',
      variable: v,
      n: n,
      mean: m,
      std: s,
      mu0: mu0,
      t: t,
      df: df,
      pvalue: pval,
      cohensD: d,
      significant: pval < 0.05
    };
    
    result+=tableHTML(
      ["N","í‰ê· ","í‘œì¤€í¸ì°¨","t","df","p","Cohen's d"],
      [[n,m.toFixed(2),s.toFixed(2),t.toFixed(3),df,formatP(pval),d.toFixed(3)]]
    );

    // ë°€ë„ë¶„í¬ì™€ ê¸°ê°ì—­ì„ í¬í•¨í•œ ê·¸ë˜í”„
    const xRange = [];
    const yDensity = [];
    const xCritical = [];
    const yCritical = [];
    
    const alpha = 0.05;
    const tCritical = 2.086;
    const xMin = -4;
    const xMax = 4;
    const steps = 200;
    
    for (let i = 0; i <= steps; i++) {
      const xVal = xMin + (xMax - xMin) * i / steps;
      xRange.push(xVal);
      yDensity.push(tPdf(xVal, df));
      
      if (Math.abs(xVal) >= tCritical) {
        xCritical.push(xVal);
        yCritical.push(tPdf(xVal, df));
      }
    }
    
    plotData = [
      {
        x: xRange,
        y: yDensity,
        type: 'scatter',
        mode: 'lines',
        name: 't-ë¶„í¬',
        line: { color: '#2563eb', width: 2 }
      },
      {
        x: xCritical,
        y: yCritical,
        type: 'scatter',
        mode: 'lines',
        fill: 'tonexty',
        name: 'ê¸°ê°ì—­ (Î±=0.05)',
        line: { color: '#dc2626' },
        fillcolor: 'rgba(220, 38, 38, 0.3)'
      },
      {
        x: [t, t],
        y: [0, tPdf(t, df)],
        type: 'scatter',
        mode: 'lines',
        name: `ê´€ì¸¡ëœ t = ${t.toFixed(3)}`,
        line: { color: '#059669', width: 3, dash: 'dash' }
      }
    ];
    
    layout = {
      title: `ë‹¨ì¼í‘œë³¸ t-ê²€ì •: ${v} (Î¼â‚€ = ${mu0})`,
      xaxis: { title: 't ê°’' },
      yaxis: { title: 'í™•ë¥ ë°€ë„' },
      showlegend: true
    };
  }

  else if(type==="independent"||type==="welch"){
    const gVar=document.getElementById('groupVar').value;
    const v=document.getElementById('indVar').value;
    const groups={};
    currentData.forEach(r=>{
      if(r[gVar]!==''&&!isNaN(parseFloat(r[v]))){
        if(!groups[r[gVar]]) groups[r[gVar]]=[];
        groups[r[gVar]].push(parseFloat(r[v]));
      }
    });
    const keys=Object.keys(groups);
    if(keys.length!==2){alert("ë‘ ì§‘ë‹¨ í•„ìš”");return;}
    const g1=groups[keys[0]], g2=groups[keys[1]];
    const m1=mean(g1), m2=mean(g2), sd1=std(g1), sd2=std(g2);
    const n1=g1.length, n2=g2.length;

    let t,df;
    if(type==="independent"){
      const sp=Math.sqrt(((n1-1)*sd1*sd1+(n2-1)*sd2*sd2)/(n1+n2-2));
      t=(m1-m2)/(sp*Math.sqrt(1/n1+1/n2));
      df=n1+n2-2;
    }else{
      t=(m1-m2)/Math.sqrt(sd1*sd1/n1+sd2*sd2/n2);
      df=Math.pow(sd1*sd1/n1+sd2*sd2/n2,2)/((Math.pow(sd1*sd1/n1,2)/(n1-1))+(Math.pow(sd2*sd2/n2,2)/(n2-1)));
    }
    pval=2*(1-tCdf(Math.abs(t),df));
    const sp=(type==="independent")?Math.sqrt(((n1-1)*sd1*sd1+(n2-1)*sd2*sd2)/(n1+n2-2)):Math.sqrt((sd1*sd1+sd2*sd2)/2);
    const d=(m1-m2)/sp;

    // í•´ì„ìš© ê²°ê³¼ ì €ì¥
    testResult = {
      type: type==="independent" ? 'ë…ë¦½í‘œë³¸ t-ê²€ì • (Student)' : 'ë…ë¦½í‘œë³¸ t-ê²€ì • (Welch)',
      groupVar: gVar,
      variable: v,
      group1: keys[0],
      group2: keys[1],
      n1: n1,
      n2: n2,
      mean1: m1,
      mean2: m2,
      std1: sd1,
      std2: sd2,
      t: t,
      df: df,
      pvalue: pval,
      cohensD: d,
      significant: pval < 0.05,
      meanDiff: m1 - m2
    };

    result+=tableHTML(
      ["ì§‘ë‹¨","N","í‰ê· ","í‘œì¤€í¸ì°¨"],
      [[keys[0],n1,m1.toFixed(2),sd1.toFixed(2)],[keys[1],n2,m2.toFixed(2),sd2.toFixed(2)]]
    );
    result+=tableHTML(
      ["t","df","p","Cohen's d"],
      [[t.toFixed(3),df.toFixed(1),formatP(pval),d.toFixed(3)]]
    );
    plotData=[{y:g1,type:'box',name:keys[0]},{y:g2,type:'box',name:keys[1]}];
    layout={title:`${type==="independent"?"ë…ë¦½(Student)":"Welch"} t-ê²€ì •: ${keys[0]} vs ${keys[1]} (${v})`};
  }

  else if(type==="paired"){
    const v1=document.getElementById('pair1').value;
    const v2=document.getElementById('pair2').value;
    const pairs = [];
    
    currentData.forEach(r => {
      const val1 = parseFloat(r[v1]);
      const val2 = parseFloat(r[v2]);
      if (!isNaN(val1) && !isNaN(val2)) {
        pairs.push({[v1]: val1, [v2]: val2});
      }
    });
    
    if(pairs.length === 0){alert("ìœ íš¨í•œ ìŒ ë°ì´í„° ì—†ìŒ");return;}
    
    const x1 = pairs.map(p => p[v1]);
    const x2 = pairs.map(p => p[v2]);
    const dVals = x1.map((a,i) => a - x2[i]);
    const md = mean(dVals), sd = std(dVals), n = x1.length;
    const t = md / (sd / Math.sqrt(n));
    const df = n - 1; 
    pval = 2 * (1 - tCdf(Math.abs(t), df));
    const d = md / sd;
    
    // í•´ì„ìš© ê²°ê³¼ ì €ì¥
    testResult = {
      type: 'ëŒ€ì‘í‘œë³¸ t-ê²€ì •',
      variable1: v1,
      variable2: v2,
      n: n,
      mean1: mean(x1),
      mean2: mean(x2),
      meanDiff: md,
      stdDiff: sd,
      t: t,
      df: df,
      pvalue: pval,
      cohensD: d,
      significant: pval < 0.05
    };
    
    result += tableHTML(
      ["N","í‰ê· ì°¨","í‘œì¤€í¸ì°¨(ì°¨)","t","df","p","Cohen's d"],
      [[n,md.toFixed(2),sd.toFixed(2),t.toFixed(3),df,formatP(pval),d.toFixed(3)]]
    );
    
    plotData = [
      {y: x1, type: 'box', name: v1},
      {y: x2, type: 'box', name: v2}
    ];
    layout = {title: `ëŒ€ì‘í‘œë³¸ t-ê²€ì •: ${v1} vs ${v2}`};
  }

  document.getElementById('resultTables').innerHTML=result;
  document.getElementById('resultsPanel').style.display='block';
  Plotly.newPlot('ttestPlot',plotData,layout,{displayModeBar:false});
  
  // í•´ì„ ìƒì„±
  generateInterpretation(testResult);
}

// í•´ì„ ìƒì„± í•¨ìˆ˜
function generateInterpretation(result) {
  if (!result) return;

  let html = '<div class="interpretation">';
  html += '<h4>ğŸ“Š t-ê²€ì • ê²°ê³¼ í•´ì„</h4>';
  
  // ìœ ì˜ì„± ê²€ì • ê²°ê³¼
  if (result.pvalue < 0.001) {
    html += `<div style="margin-bottom:15px;"><strong>ë§¤ìš° ê°•í•œ ìœ ì˜ì„±:</strong><br>`;
    html += `â€¢ p < 0.001ë¡œ <span class="status-badge status-danger">ë§¤ìš° ë†’ì€ ìœ ì˜ìˆ˜ì¤€</span>ì—ì„œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.<br>`;
  } else if (result.pvalue < 0.01) {
    html += `<div style="margin-bottom:15px;"><strong>ê°•í•œ ìœ ì˜ì„±:</strong><br>`;
    html += `â€¢ p < 0.01ë¡œ <span class="status-badge status-danger">ë†’ì€ ìœ ì˜ìˆ˜ì¤€</span>ì—ì„œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.<br>`;
  } else if (result.pvalue < 0.05) {
    html += `<div style="margin-bottom:15px;"><strong>ìœ ì˜í•œ ì°¨ì´:</strong><br>`;
    html += `â€¢ p < 0.05ë¡œ <span class="status-badge status-danger">í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ ì°¨ì´</span>ê°€ ìˆìŠµë‹ˆë‹¤.<br>`;
  } else {
    html += `<div style="margin-bottom:15px;"><strong>ìœ ì˜í•˜ì§€ ì•ŠìŒ:</strong><br>`;
    html += `â€¢ p = ${result.pvalue.toFixed(3)}ìœ¼ë¡œ <span class="status-badge status-success">í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤</span>.<br>`;
  }
  
  // ê²€ì •ë³„ êµ¬ì²´ì  í•´ì„
  if (result.type === 'ë‹¨ì¼í‘œë³¸ t-ê²€ì •') {
    html += `â€¢ í‘œë³¸í‰ê·  ${result.mean.toFixed(2)}ì™€ ëª¨ì§‘ë‹¨ ê¸°ì¤€ê°’ ${result.mu0} ê°„ì˜ ì°¨ì´ë¥¼ ê²€ì •í–ˆìŠµë‹ˆë‹¤.<br>`;
    if (result.significant) {
      if (result.mean > result.mu0) {
        html += `â€¢ í‘œë³¸í‰ê· ì´ ê¸°ì¤€ê°’ë³´ë‹¤ <strong>ìœ ì˜í•˜ê²Œ ë†’ìŠµë‹ˆë‹¤</strong>.<br>`;
      } else {
        html += `â€¢ í‘œë³¸í‰ê· ì´ ê¸°ì¤€ê°’ë³´ë‹¤ <strong>ìœ ì˜í•˜ê²Œ ë‚®ìŠµë‹ˆë‹¤</strong>.<br>`;
      }
    } else {
      html += `â€¢ í‘œë³¸í‰ê· ê³¼ ê¸°ì¤€ê°’ ì‚¬ì´ì— <strong>ìœ ì˜í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤</strong>.<br>`;
    }
    html += `</div>`;
    
  } else if (result.type.includes('ë…ë¦½í‘œë³¸')) {
    html += `â€¢ ${result.group1}(í‰ê· : ${result.mean1.toFixed(2)})ê³¼ ${result.group2}(í‰ê· : ${result.mean2.toFixed(2)}) ì§‘ë‹¨ ê°„ ${result.variable}ì˜ ì°¨ì´ë¥¼ ê²€ì •í–ˆìŠµë‹ˆë‹¤.<br>`;
    if (result.significant) {
      if (result.meanDiff > 0) {
        html += `â€¢ ${result.group1} ì§‘ë‹¨ì´ ${result.group2} ì§‘ë‹¨ë³´ë‹¤ <strong>ìœ ì˜í•˜ê²Œ ë†’ì€ ê°’</strong>ì„ ë³´ì…ë‹ˆë‹¤ (ì°¨ì´: ${Math.abs(result.meanDiff).toFixed(2)}).<br>`;
      } else {
        html += `â€¢ ${result.group2} ì§‘ë‹¨ì´ ${result.group1} ì§‘ë‹¨ë³´ë‹¤ <strong>ìœ ì˜í•˜ê²Œ ë†’ì€ ê°’</strong>ì„ ë³´ì…ë‹ˆë‹¤ (ì°¨ì´: ${Math.abs(result.meanDiff).toFixed(2)}).<br>`;
      }
    } else {
      html += `â€¢ ë‘ ì§‘ë‹¨ ê°„ì— <strong>ìœ ì˜í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤</strong>.<br>`;
    }
    html += `</div>`;
    
  } else if (result.type === 'ëŒ€ì‘í‘œë³¸ t-ê²€ì •') {
    html += `â€¢ ${result.variable1}(í‰ê· : ${result.mean1.toFixed(2)})ê³¼ ${result.variable2}(í‰ê· : ${result.mean2.toFixed(2)}) ê°„ì˜ ì°¨ì´ë¥¼ ê²€ì •í–ˆìŠµë‹ˆë‹¤.<br>`;
    if (result.significant) {
      if (result.meanDiff > 0) {
        html += `â€¢ ${result.variable1}ì´ ${result.variable2}ë³´ë‹¤ <strong>ìœ ì˜í•˜ê²Œ ë†’ìŠµë‹ˆë‹¤</strong> (í‰ê· ì°¨ì´: ${result.meanDiff.toFixed(2)}).<br>`;
      } else {
        html += `â€¢ ${result.variable2}ê°€ ${result.variable1}ë³´ë‹¤ <strong>ìœ ì˜í•˜ê²Œ ë†’ìŠµë‹ˆë‹¤</strong> (í‰ê· ì°¨ì´: ${Math.abs(result.meanDiff).toFixed(2)}).<br>`;
      }
    } else {
      html += `â€¢ ë‘ ì¸¡ì •ê°’ ê°„ì— <strong>ìœ ì˜í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤</strong>.<br>`;
    }
    html += `</div>`;
  }
  
  // íš¨ê³¼í¬ê¸° í•´ì„
  html += `<div style="margin-bottom:15px;"><strong>íš¨ê³¼í¬ê¸° (Cohen's d = ${result.cohensD.toFixed(3)}):</strong><br>`;
  const absD = Math.abs(result.cohensD);
  if (absD < 0.2) {
    html += `â€¢ <strong>ë§¤ìš° ì‘ì€ íš¨ê³¼í¬ê¸°</strong>ì…ë‹ˆë‹¤. ì‹¤ì§ˆì  ì°¨ì´ëŠ” ë¯¸ë¯¸í•©ë‹ˆë‹¤.<br>`;
  } else if (absD < 0.5) {
    html += `â€¢ <strong>ì‘ì€ íš¨ê³¼í¬ê¸°</strong>ì…ë‹ˆë‹¤. ì‹¤ì§ˆì ìœ¼ë¡œ ì‘ì€ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.<br>`;
  } else if (absD < 0.8) {
    html += `â€¢ <strong>ì¤‘ê°„ íš¨ê³¼í¬ê¸°</strong>ì…ë‹ˆë‹¤. ì‹¤ì§ˆì ìœ¼ë¡œ ì˜ë¯¸ìˆëŠ” ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.<br>`;
  } else {
    html += `â€¢ <strong>í° íš¨ê³¼í¬ê¸°</strong>ì…ë‹ˆë‹¤. ì‹¤ì§ˆì ìœ¼ë¡œ ë§¤ìš° í° ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.<br>`;
  }
  html += `</div>`;
  
  // ì‹¤ìš©ì  ê²°ë¡ 
  html += `<div style="margin-bottom:15px;"><strong>ì‹¤ìš©ì  ê²°ë¡ :</strong><br>`;
  if (result.significant && absD >= 0.2) {
    html += `â€¢ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ê³  ì‹¤ì§ˆì ìœ¼ë¡œë„ ì˜ë¯¸ìˆëŠ” ì°¨ì´ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.<br>`;
    html += `â€¢ ì´ ê²°ê³¼ëŠ” <strong>ì‹¤ì œ ì ìš©ì—ì„œ ê³ ë ¤í•  ë§Œí•œ ì°¨ì´</strong>ë¡œ í•´ì„ë©ë‹ˆë‹¤.<br>`;
  } else if (result.significant && absD < 0.2) {
    html += `â€¢ í†µê³„ì ìœ¼ë¡œëŠ” ìœ ì˜í•˜ì§€ë§Œ íš¨ê³¼í¬ê¸°ê°€ ì‘ì•„ <strong>ì‹¤ì§ˆì  ì˜ë¯¸ëŠ” ì œí•œì </strong>ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>`;
    html += `â€¢ í‘œë³¸ í¬ê¸°ê°€ í´ ë•Œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆëŠ” í˜„ìƒì…ë‹ˆë‹¤.<br>`;
  } else {
    html += `â€¢ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ ì°¨ì´ê°€ ì—†ìœ¼ë¯€ë¡œ <strong>í˜„ì¬ ì¦ê±°ë¡œëŠ” ì°¨ì´ê°€ ìˆë‹¤ê³  ê²°ë¡ ë‚´ë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</strong>.<br>`;
  }
  html += `</div>`;
  
  html += '</div>';
  
  document.getElementById('interpretation').innerHTML = html;
  document.getElementById('interpretationPanel').style.display = 'block';
}

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
function tableHTML(headers,rows){
  let html="<table><thead><tr>";
  headers.forEach(h=>html+=`<th>${h}</th>`);
  html+="</tr></thead><tbody>";
  rows.forEach(r=>{
    html+="<tr>";
    if(!Array.isArray(r)) r=[r];
    r.forEach(v=>{html+=`<td>${v}</td>`;});
    html+="</tr>";
  });
  html+="</tbody></table>";
  return html;
}

function mean(a){return a.reduce((x,y)=>x+y,0)/a.length;}
function std(a){const m=mean(a);return Math.sqrt(a.reduce((s,x)=>s+(x-m)**2,0)/(a.length-1));}
function formatP(p){return p<0.05?`<span class='sig'>${p.toFixed(3)} â˜…</span>`:`<span class='nsig'>${p.toFixed(3)}</span>`;}

function resetAll(){
  currentData=null;
  document.getElementById('dataPreview').innerHTML='';
  document.getElementById('dataInfo').style.display='none';
  document.getElementById('varPanel').style.display='none';
  document.getElementById('resultsPanel').style.display='none';
  document.getElementById('fileInput').value='';
}

// ë©”ë‰´ ë„¤ë¹„ê²Œì´ì…˜
document.querySelectorAll('.menu-item').forEach(item => {
  item.addEventListener('click', function() {
    const target = this.dataset.target;
    if (target) {
      const currentPage = window.location.pathname.split('/').pop();
      if (target !== currentPage) {
        window.location.href = target;
      }
    }
  });
});
</script>
</body>
</html>
