<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>í†µê³„ë¶„ì„ ì¢…í•©ë„êµ¬</title>

<!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

<style>
  body {font-family: sans-serif; margin:0; display:flex; min-height:100vh; background:#f4f5f7;}
  .sidebar {width:250px; background:#ffffff; padding:20px; box-shadow:0 0 8px rgba(0,0,0,0.1);}
  .menu-item {padding:10px; margin:5px 0; cursor:pointer; border-radius:6px; color:#333;}
  .menu-item.active {background:#2563eb; color:#fff;}
  .main {flex:1; padding:20px;}
  .analysis-section {display:none;}
  .analysis-section.active {display:block;}

  /* ì¹´ë“œ/ë²„íŠ¼/í…Œì´ë¸” */
  .panel{background:#fff;border-radius:16px;padding:18px;box-shadow:0 8px 30px rgba(16,24,40,0.06);margin-bottom:20px}
  h1{margin:0;font-size:22px;color:#2563eb}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .btn{border:0;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn.primary{background:#2563eb;color:#fff}
  .btn.success{background:#059669;color:#fff}
  .btn.ghost{background:#f3f4f6;color:#111827}

  /* í…Œì´ë¸” */
  .styled-table {width:100%;border-collapse:collapse;margin-top:12px;font-size:13px}
  .styled-table th, .styled-table td {padding:8px 12px;border-bottom:1px solid #eef2f7;text-align:center}
  .styled-table th {background:#f8fafc;font-weight:600}

  /* p-value ê°•ì¡° */
  .sig{color:#059669;font-weight:700;}
  .nsig{color:#9ca3af;font-weight:700;}
</style>
</head>
<body>

  <!-- ì‚¬ì´ë“œë°” -->
  <div class="sidebar">
    <h2>ğŸ“Š ë¶„ì„ë„êµ¬</h2>
    <div class="menu-item active" data-section="descriptive">ê¸°ìˆ í†µê³„</div>
    <div class="menu-item" data-section="ttest">T-ê²€ì •</div>
  </div>

  <!-- ë©”ì¸ -->
  <div class="main">
    <!-- ê¸°ìˆ í†µê³„ ìë¦¬ -->
    <div id="descriptiveSection" class="analysis-section active">
      <h1>ğŸ“Š ê¸°ìˆ í†µê³„</h1>
      <p>ì—¬ê¸°ì— ê¸°ìˆ í†µê³„ ê¸°ëŠ¥ì´ ë“¤ì–´ê°ˆ ìë¦¬ì…ë‹ˆë‹¤.</p>
    </div>

    <!-- T-ê²€ì • ë„êµ¬ -->
    <div id="ttestSection" class="analysis-section">
      <div class="panel">
        <h1>t-ê²€ì • ì˜¬ì¸ì› ë„êµ¬</h1>
        <div class="muted">CSV ì—…ë¡œë“œ â†’ ê²€ì • ì¢…ë¥˜ ì„ íƒ â†’ ë³€ìˆ˜ ì„¤ì • â†’ ì‹¤í–‰</div>
      </div>

      <div class="panel">
        <div class="controls">
          <input id="fileInput" type="file" accept=".csv">
          <button class="btn success" onclick="loadExample()">ì˜ˆì œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn ghost" onclick="resetAll()">ì´ˆê¸°í™”</button>
        </div>
        <div id="dataPreview"></div>
      </div>

      <div class="panel" id="varPanel" style="display:none;">
        <div>ê²€ì • ì¢…ë¥˜</div>
        <select id="testType" onchange="updateVarUI()">
          <option value="one">ë‹¨ì¼í‘œë³¸ t-ê²€ì •</option>
          <option value="independent">ë…ë¦½í‘œë³¸ t-ê²€ì • (Student)</option>
          <option value="welch">ë…ë¦½í‘œë³¸ t-ê²€ì • (Welch)</option>
          <option value="paired">ëŒ€ì‘í‘œë³¸ t-ê²€ì •</option>
        </select>

        <div id="varSettings" style="margin-top:16px;"></div>
        <div class="controls"><button class="btn primary" onclick="runTtest()">ğŸš€ ì‹¤í–‰</button></div>
      </div>

      <div class="panel" id="resultsPanel" style="display:none;">
        <div class="section-title">ë¶„ì„ ê²°ê³¼</div>
        <div id="resultTables"></div>
        <div id="ttestPlot" style="height:350px;margin-top:20px;"></div>
      </div>
    </div>
  </div>

<script>
let currentData=null;

// âœ… ì˜ˆì œ ë°ì´í„°
function loadExample(){
  const example=[
    {group:"ë‚¨", score:85, pre:70, post:80},
    {group:"ë‚¨", score:78, pre:68, post:74},
    {group:"ë‚¨", score:90, pre:72, post:88},
    {group:"ì—¬", score:88, pre:75, post:85},
    {group:"ì—¬", score:92, pre:77, post:90},
    {group:"ì—¬", score:95, pre:74, post:93}
  ];
  processData(example);
}

// CSV íŒŒì¼ ë¡œë“œ
document.getElementById('fileInput').addEventListener('change', function(event) {
  const file = event.target.files[0];
  if (file && file.type === "text/csv") {
    Papa.parse(file, {
      complete: function(results) {
        processData(results.data.slice(1).map(row => {
          const obj = {};
          results.data[0].forEach((header, index) => {
            obj[header] = row[index];
          });
          return obj;
        }));
      },
      header: false
    });
  }
});

// âœ… ë°ì´í„° ì²˜ë¦¬
function processData(data){
  currentData=data;
  const headers=Object.keys(data[0]);
  let preview='<table class="styled-table"><thead><tr>';
  headers.forEach(h=>preview+=`<th>${h}</th>`); preview+='</tr></thead><tbody>';
  data.slice(0,5).forEach(r=>{
    preview+='<tr>';
    headers.forEach(h=>preview+=`<td>${r[h]}</td>`);
    preview+='</tr>';
  });
  preview+='</tbody></table>';
  document.getElementById('dataPreview').innerHTML=preview;
  updateVarUI(headers);
  document.getElementById('varPanel').style.display='block';
}

// âœ… ë³€ìˆ˜ UI ì—…ë°ì´íŠ¸
function updateVarUI(headers=null){
  if(!headers&&currentData) headers=Object.keys(currentData[0]);
  const type=document.getElementById('testType').value;
  let html="";
  if(type==="one"){
    html=`<div class="grid-2">
      <div><div>ë¶„ì„ ë³€ìˆ˜</div><select id="oneVar">${headers.map(h=>`<option>${h}</option>`).join('')}</select></div>
      <div><div>ë¹„êµ ê¸°ì¤€ê°’ Î¼â‚€</div><input id="mu0" type="number" value="80"></div></div>`;
  }else if(type==="independent"||type==="welch"){
    html=`<div class="grid-2">
      <div><div>ì§‘ë‹¨ ë³€ìˆ˜</div><select id="groupVar">${headers.map(h=>`<option>${h}</option>`).join('')}</select></div>
      <div><div>ë¶„ì„ ë³€ìˆ˜</div><select id="indVar">${headers.map(h=>`<option>${h}</option>`).join('')}</select></div></div>`;
  }else if(type==="paired"){
    html=`<div class="grid-2">
      <div><div>ë³€ìˆ˜ 1 (ì‚¬ì „)</div><select id="pair1">${headers.map(h=>`<option>${h}</option>`).join('')}</select></div>
      <div><div>ë³€ìˆ˜ 2 (ì‚¬í›„)</div><select id="pair2">${headers.map(h=>`<option>${h}</option>`).join('')}</select></div></div>`;
  }
  document.getElementById('varSettings').innerHTML=html;
}

// âœ… ìœ í‹¸
function tableHTML(headers,rows){
  let html="<table class='styled-table'><thead><tr>";
  headers.forEach(h=>html+=`<th>${h}</th>`);
  html+="</tr></thead><tbody>";
  rows.forEach(r=>{
    html+="<tr>";
    if(!Array.isArray(r)) r=[r];
    r.forEach(v=>{html+=`<td>${v}</td>`;});
    html+="</tr>";
  });
  html+="</tbody></table>";
  return html;
}
function mean(a){return a.reduce((x,y)=>x+y,0)/a.length;}
function std(a){const m=mean(a);return Math.sqrt(a.reduce((s,x)=>s+(x-m)**2,0)/(a.length-1));}
function formatP(p){return p<0.05?`<span class='sig'>${p.toFixed(3)} â˜…</span>`:`<span class='nsig'>${p.toFixed(3)}</span>`;}
function resetAll(){
  currentData=null;
  document.getElementById('dataPreview').innerHTML='';
  document.getElementById('varPanel').style.display='none';
  document.getElementById('resultsPanel').style.display='none';
  document.getElementById('fileInput').value='';
}

// âœ… ì‚¬ì´ë“œë°” ì„¹ì…˜ ì „í™˜
document.querySelectorAll('.menu-item').forEach(item=>{
  item.addEventListener('click', ()=>{
    document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active'));
    item.classList.add('active');
    document.querySelectorAll('.analysis-section').forEach(sec=>sec.classList.remove('active'));
    document.getElementById(item.dataset.section+"Section").classList.add('active');
  });
});
</script>
</body>
</html>
